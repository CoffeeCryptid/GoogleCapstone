---
title: "Case Study: How Can a Wellness Technology Company Play It Smart?"
author: "Sarah Thiesen"
date: "20 8 2021"
output: html_document
---

## Business Task

Identify trends in the usage of fitness trackers, and use these insights to help ajust the BellaBeat marketing strategy for their BellaBeat Leaf.

## Data Sources

The data is from the [FitBit Fitness Tracker Data](https://www.kaggle.com/arashnic/fitbit) on Kaggle. This collection of datasets includes personal tracker data from thirty FitBit users, including minute-level output for physical activity, heart rate, and sleep monitoring. The data was recorded in December 2016.

Limitations:  
<ul>
  <li>Data is not recent (collected in 2016)</li>
  <li>Sample is relatively small (33 respondents)</li>
  <li>Demographic data of respondents is not included. This is especially problematic since BellaBeat's main customer base is female, and it is unclear how many women are included in the sample, and how they might differ from men in their FitBit usage.</li>
</ul>

## Data Cleaning and Manipulation

The data contains dates and time as strings. These need to be converted into appropriate formats for analysis.  
Identify and remove Duplicate data  
Merge datasets  

### Data Preparation Daily Data:
```{r, message = F, results = "asis"}
library(dplyr)
library(tidyr)
library(ggplot2)
library(lubridate)
library(scales)

dailyActivity <- read.csv("FitBaseData/dailyActivity_merged.csv") %>%
  mutate(ActivityDate = as.Date(ActivityDate, "%m/%d/%Y"))

dailySleep <- read.csv("FitBaseData/sleepDay_merged.csv") %>%
  mutate(SleepDay = strptime(SleepDay, "%m/%d/%Y %I:%M:%S %p"), ActivityDate = as.Date(SleepDay))

dailyWeight <- read.csv("FitBaseData/weightLogInfo_merged.csv") %>%
  mutate(Date = strptime(Date, "%m/%d/%Y %I:%M:%S %p"), ActivityDate = as.Date(Date))

cat(sprintf("Duplicate rows:  
* Activity Log: %i  
* Sleep Log: %i  
* Weight log: %i", 
  sum(duplicated(dailyActivity)), 
  sum(duplicated(dailySleep)),
  sum(duplicated(dailyWeight))))

#Remove duplicate rows
dailySleep <- distinct(dailySleep)

#Merge Data
dailyData <- left_join(dailyActivity, dailySleep, by = c("Id", "ActivityDate")) %>%
  left_join(dailyWeight, by = c("Id", "ActivityDate")) %>%
  select(-LogId, -IsManualReport, -WeightPounds)

#Clean up
#rm(dailyActivity, dailySleep, dailyWeight)
```

### Data Preparation Hourly Data

```{r, message = F, results = "asis"}
hourlyIntensity <- read.csv("FitBaseData/hourlyIntensities_merged.csv") 
hourlyCalories <- read.csv("FitBaseData/hourlyCalories_merged.csv")
hourlySteps <- read.csv("FitBaseData/hourlySteps_merged.csv")

cat(sprintf("Number of duplicate rows:  
* Intensity Log: %i  
* Calories Log: %i  
* Steps Log: %i",
              sum(duplicated(hourlyIntensity)),
              sum(duplicated(hourlyCalories)),
              sum(duplicated(hourlySteps))))

#Merge Data
hourlyData <- full_join(hourlyIntensity, hourlyCalories, by = c("Id", "ActivityHour")) %>%
  full_join(hourlySteps, by = c("Id", "ActivityHour")) %>%
  mutate(ActivityHour = strptime(ActivityHour, "%m/%d/%Y %I:%M:%S %p"),
         ActivityDate = as.Date(ActivityHour))

#Clean up
rm(hourlyCalories, hourlyIntensity, hourlySteps)

cat(paste("Number of NA values:", sum(is.na(hourlyData))))
```

## Analysis

### Which functions are used?

Use daily data to analyze which functions are used  
Actity data: on how many days for every respondent are steps recorded?  
Sleep data: on how many days is sleep recorded?  
Weight data: how many weight records exist for every person?

```{r}
dailyUsage <- group_by(dailyData, Id) %>%
  summarise(Activity = sum(TotalSteps > 0, na.rm = TRUE),
            Sleep = sum(!is.na(TotalMinutesAsleep)),
            Weight = sum(!is.na(WeightKg), na.rm = TRUE),
            SleepWeight = sum(!is.na(TotalMinutesAsleep) | !is.na(WeightKg)),
            n = n())

pivot_longer(dailyUsage, cols = Activity:Weight, 
             names_to = "Variable", values_to = "Value") %>%
  ggplot(aes(x = Value, fill = Variable)) +
  geom_histogram(binwidth = 1) +
  facet_grid(Variable ~ .) + 
  ggtitle("Usage of FitBit functions") +
  xlab("Days Used") + 
  ylab("Count") +
  theme(legend.position = "none")
```

```{r}
mutate(dailyUsage, WeightGroup = case_when(Weight > 20 ~ 3, Weight > 0 ~ 2, TRUE ~ 1) %>% 
         ordered(levels = c(1:3), labels = c("never used", "used occasionally", "used frequently"))) %>%
  ggplot(aes(x = Activity, y = Sleep, size = WeightGroup, color = WeightGroup)) +
  geom_point() + 
  scale_color_brewer(palette="RdYlGn")
```

### Grouping

Group users into three groups:
- Occasional users: use FitBit irregularly  
- Frequent users: use FitBit frequently, but mainly use Activity tracking and don't make frequent use of sleep tracking or weight tracking  
- Heavy users: use FitBit frequently for both activity tracking as well as sleep tracking or weight tracking

```{r}
set.seed(10)
km <- select(dailyUsage, Activity, SleepWeight) %>% kmeans(3)

dailyUsage$cluster <- factor(km$cluster, levels = c(1:3), labels = c("Occasional Users", "Frequent Users", "Heavy Users"))

ggplot(dailyUsage, aes(x = Activity, y = SleepWeight, color = cluster)) +
  geom_point()
```

## Key Findings

## Recommendations